<!doctype html>
<html lang="pt">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Consumo Diário — Shelly (Gen2)</title>
<link rel="manifest" href="manifest.json">
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;max-width:820px;margin:24px auto;padding:0 12px}
  header{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
  h1{margin:0;font-size:1.4rem}
  .card{border:1px solid #ddd;border-radius:10px;padding:14px;margin:12px 0}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .row > *{flex:1 1 200px}
  label{display:block;font-size:.9rem;margin:.3rem 0}
  input,select,button{width:100%;padding:8px;border:1px solid #bbb;border-radius:8px}
  button{cursor:pointer}
  .kpis{display:flex;gap:10px;flex-wrap:wrap}
  .kpi{flex:1 1 150px;border:1px solid #eee;border-radius:10px;padding:10px}
  .muted{color:#666}
</style>
<body>
<header>
  <h1>Consumo Diário — Shelly (Gen2)</h1>
  <div class="muted" id="appVersion"></div>
</header>

<div class="card">
  <h3>Configuração</h3>
  <div class="row">
    <div>
      <label>Modo</label>
      <select id="mode">
        <option value="cloud">CLOUD (proxy HTTPS, recomendado p/ GitHub Pages)</option>
        <option value="local">LOCAL (LAN via RPC/CSV — abrir site por http)</option>
        <option value="demo">DEMO</option>
      </select>
    </div>
    <div id="cloudBox">
      <label>Endpoint HTTPS (Worker/Function)</label>
      <input id="cloudUrl" placeholder="https://example.com/api/shelly/daily?date=YYYY-MM-DD">
      <small class="muted">Devolve JSON com {kwh,minW,avgW,maxW,peakAt}.</small>
    </div>
    <div id="localBox" style="display:none">
      <label>IP do Shelly (LAN)</label>
      <input id="shellyIp" placeholder="192.168.1.50">
      <small class="muted">Suporta EMData (3EM, etc.) e EM1Data (Pro EM-50 com 2 canais).</small>
    </div>
  </div>
  <div class="row">
    <button id="saveCfg">Guardar</button>
    <button id="pullToday">Atualizar hoje</button>
    <button id="markDone">Marcar dia como concluído</button>
    <button id="reset">Repor</button>
  </div>
  <small id="cfgHint" class="muted"></small>
</div>

<div class="card">
  <h3>Resumo de hoje (<span id="todayLabel"></span>)</h3>
  <div class="kpis">
    <div class="kpi"><div class="muted">Energia</div><div id="kpiKwh" style="font-size:1.4rem">— kWh</div></div>
    <div class="kpi"><div class="muted">Pico</div><div id="kpiPico">— W</div></div>
    <div class="kpi"><div class="muted">Média</div><div id="kpiAvg">— W</div></div>
    <div class="kpi"><div class="muted">Load factor</div><div id="kpiLF">—</div></div>
  </div>
  <small class="muted" id="todayNote"></small>
</div>

<div class="card">
  <h3>Relatórios</h3>
  <canvas id="chartDaily" height="200"></canvas>
  <br>
  <canvas id="chartWeekly" height="200"></canvas>
</div>

<div class="card">
  <h3>Histórico</h3>
  <div id="history"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="script.js"></script>
</body>
</html>
